{{>userHeader}}

{{>adminDashboardSide}}

<body id="page-top">
    <div id="wrapper">
        <div id="content-wrapper" class="d-flex flex-column">
            <div id="content">
                <nav
                    class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow justify-content-between">
                    <form action="/owner/hotel" method="post">

                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..."
                                aria-label="Search" aria-describedby="basic-addon2" name="search">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </form>

                    <a href="/owner/addhotel" class="h3 mb-0 text-gray-800 text-light m-3 btn btn-primary">
                        Add Hotel</a>
                </nav>


                <div class="container-fluid">


                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <a href="/owner/hotels" class="m-0 font-weight-bold text-primary">HOTELS</a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Total Revenue</th>
                                            <th>No of Rooms</th>
                                            <th>Type</th>
                                            <th>Is Blocked</th>
                                            <th>Is Available</th>
                                            <th>More</th>
                                            <th>Add Rooms</th>
                                            {{!-- <th>Hotels</th> --}}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{#each hotel}}
                                        <tr>
                                            <td>{{this.name}}</td>
                                            <td>{{this.revenu}}</td>
                                            <td>{{this.rooms}}</td>
                                            <td>{{this.type.name}}</td>
                                            <td>{{this.is_block}}</td>

                                            {{#if this.is_Available}}
                                            <td>
                                                <form action="/owner/hotel/edit?id={{this._id}}" method="post">
                                                    {{!-- <input type="hidden" name="id" value="{{this._id}}"> --}}
                                                    <button class="btn btn-primary btn-block" type="submit"
                                                        name="availability" value="false">Available</button>
                                                </form>
                                            </td>
                                            {{else}}
                                            <td>
                                                <form action="/owner/hotel/edit?id={{this._id}}" method="post">
                                                    {{!-- <input type="hidden" name="id" value="{{this._id}}"> --}}
                                                    <button class="btn btn-warning btn-block" type="submit"
                                                        name="availability" value="true">Not Available</button>
                                                </form>
                                            </td>
                                            {{/if}}



                                            <td>
                                                <a href="/owner/hotel/view?id={{this.id}}"
                                                    class="btn btn-primary">View</a>
                                            </td>
                                            <td>
                                                <a href="/owner/hotel/addrooms?id={{this.id}}"
                                                    class="btn btn-primary">Add</a>
                                            </td>
                                        </tr>
                                        {{/each}}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>
    </div>
</body>

</html>


{{>userFooter}}


<script>
    const handleSubmit = async (event) => {
        event.preventDefault();
        const formData = new FormData(event.target);
        const id = formData.get('id');

        try {
            const response = await axios.post(`/owner/hotel/edit?id=${id}`, formData, {
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.status === 200) {
                window.location.href = '/owner/hotels';
            }
        } catch (error) {
            if (error.response.status == 400) {
                alertify.alert("Something went wrong", function () {
                    alertify.message('OK');
                });
            }
            else if (error.response.status == 500) {
                const err = error.response.data.error;
                alertify.alert(err, function () {
                    alertify.message('OK');
                });
            }
            else {
                alertify.alert("Something went wrong", function () {
                    alertify.message('OK');
                });
            }
        }
    };

    document.getElementById('edit').addEventListener('submit', handleSubmit);
</script>




<script>
    const errorMessage = "{{errorMessage}}";
    if (errorMessage) {
        alertify.alert(errorMessage, function () {
            alertify.message('OK');
        });
    }
</script>