{{>userHeader}}
{{>adminDashboardSide}}

<style>
    .image-preview-container {
        display: flex;
        margin-bottom: 20px;
        width: 200px;
        max-width: 400px;
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        margin-bottom: 20px;
    }

    .image-preview {
        height: 200px;
        width: 300px;
        margin-bottom: 10px;
        margin-left: 2rem;
        border-radius: 5px;
        object-fit: cover;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
        margin: 0 10px 10px 0;
    }
</style>


<div id="content-wrapper" class="justify-content-center m-5">
    <div id="content">
        <form id="updateForm" enctype="multipart/form-data">
            <input type="text" name="id" value="{{hotel._id}}" style="display: none;">
            <div class="form-row m-4 ">
                <div class="form-group col-md-6">
                    <label>Name of the Hotel</label>
                    <input type="text" class="form-control" name="name" value="{{hotel.name}}">
                    <span id="nameError" class="text-danger error-msg"></span>
                </div>

                <div class="form-group col-md-6">
                    <label>Title (max 10 words)</label>
                    <input type="text" class="form-control" name="title" value="{{hotel.title}}">
                    <span id="titleError" class="text-danger error-msg"></span>
                </div>
            </div>
            <div class="form-row m-4">
                <div class="form-group col-md-6">
                    <label>Starting Price of the Room</label>
                    <input type="tel" class="form-control" name="startingprice" value="{{hotel.startingPrice}}">
                    <span id="priceError" class="text-danger error-msg"></span>
                </div>

                <div class="dropdown form-group col-md-3">
                    <select id="dropdownSelect" class="form-group col-md-6" name="category">
                        <option value="" disabled selected>Select Category</option>
                        {{#each type}}
                        <option value="{{this._id}}">{{this.name}}</option>
                        {{/each}}
                        <option value="new">New</option>
                    </select>

                    <div id="inputFieldContainer">
                        <input type="text" id="newInputField" name="newCatgory" placeholder="Enter a new Type">
                    </div>
                </div>


            </div>

            <div class="form-row m-4">
                <div class="form-group col-md-6">
                    <label>City</label>
                    <input type="text" class="form-control" name="city" value="{{hotel.city}}">
                    <span id="cityError" class="text-danger error-msg"></span>
                </div>
                <div class="form-group col-md-6">
                    <label>Pincode</label>
                    <input type="text" class="form-control" name="pincode" value="{{hotel.pincode}}">
                    <span id="pincodeError" class="text-danger error-msg"></span>
                </div>
            </div>

            <div class="form-row m-4">
                <div class="form-group col-md-6">
                    <label for="description">Description....</label>
                    <textarea id="description" class="form-control" name="description"
                        style="height: 150px; resize: vertical;">{{hotel.description}}</textarea>
                    <span id="descriptionError" class="text-danger error-msg"></span>
                </div>

                <div class="form-group col-md-6">
                    <label for="description">Address</label>
                    <textarea id="address" class="form-control" name="address"
                        style="height: 150px; resize: vertical;">{{hotel.address}}</textarea>
                    <span id="addressError" class="text-danger error-msg"></span>
                </div>
            </div>

    </div>

    <div class="image-preview-container">
        {{#each hotel.images}}
        <div>
            <img class="image-preview" src="{{this.url}}" alt="Image Preview">
            <input type="checkbox" name="selectedImages" value="{{this.url}}">
        </div>
        {{/each}}
    </div>

    <div class="image-preview-container" id="newImagePreviewContainer"></div>

    <input type="file" id="imageInput" name="images" multiple>
    <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>

{{>userFooter}}

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/dist/js/alertify.min.js"></script>

<script>
    const imageInput = document.getElementById('imageInput');

    const existingImagePreviewContainer = document.querySelector('.image-preview-container');

    const newImagePreviewContainer = document.getElementById('newImagePreviewContainer');


    const createImagePreview = (container, file) => {
        const img = document.createElement('img');
        img.classList.add('image-preview');
        const url = URL.createObjectURL(file);
        img.src = url;
        container.appendChild(img);
    };


    const clearImagePreview = (container) => {
        container.innerHTML = '';
    };


    imageInput.addEventListener('change', function () {
        clearImagePreview(newImagePreviewContainer);

        for (const file of imageInput.files) {
            createImagePreview(newImagePreviewContainer, file);
        }
    });

    existingImagePreviewContainer.addEventListener('click', function (event) {
        if (event.target.matches('input[type="checkbox"]')) {
            const imageUrl = event.target.value;

            if (event.target.checked) {

            } else {

            }
        }
    });

    const handleSubmit = async (event) => {
        event.preventDefault();


        try {
            const formData = new FormData(event.target);

            const selectedImages = existingImagePreviewContainer.querySelectorAll('input[type="checkbox"]:checked');
            selectedImages.forEach((checkbox) => {
                formData.append('selectedImages', checkbox.value);
            });

            for (const file of imageInput.files) {
                formData.append('newImages', file);
            }

            const response = await axios.post('/owner/hotel/edit', formData);
            // Handle the response from the server as needed
        } catch (error) {
            // Handle any errors
        }
    };


    document.getElementById('updateForm').addEventListener('submit', handleSubmit);
</script>

<script>
    const errorMessage = "{{errorMessage}}";
    if (errorMessage) {
        alertify.alert(errorMessage, function () {
            alertify.message('OK');
        });
    }
</script>